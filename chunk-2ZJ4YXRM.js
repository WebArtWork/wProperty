import{a as M,b as q}from"./chunk-ICYEOZPQ.js";import{g as I,k}from"./chunk-4JG5HFOE.js";import"./chunk-VV24HN3E.js";import{$b as R,Ab as C,O as s,P as u,Q as _,Vb as b,Xb as j,ba as f,ea as y,f as a,j as p,jb as v,lb as w,pb as g,v as m,zb as S}from"./chunk-7J63SMGH.js";var d=(()=>{let r=class r{constructor(e,i,t,n,h,F,P,D){this._translate=e,this._propertyrecordService=i,this._alert=t,this._userService=n,this._route=h,this._form=F,this._core=P,this._router=D,this.columns=["name","description","price","materials","photos","service","incident","rent"],this.form=this._form.getForm("propertyrecord",M),this.config={paginate:this.setRows.bind(this),perPage:20,setPerPage:this._propertyrecordService.setPerPage.bind(this._propertyrecordService),allDocs:!1,create:this._router.url.includes("propertiesrecords/")?()=>{this._form.modal(this.form,{label:"Create",click:(o,l)=>a(this,null,function*(){l(),this._preCreate(o),yield p(this._propertyrecordService.create(o)),this.setRows()})})}:null,update:o=>{this._form.modal(this.form,[],o).then(l=>{this._core.copy(l,o),this._propertyrecordService.update(o)})},delete:o=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this propertyrecord?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>a(this,null,function*(){yield p(this._propertyrecordService.delete(o)),this.setRows()})}]})},buttons:[{icon:"cloud_download",click:o=>{this._form.modalUnique("propertyrecord","url",o)}}],headerButtons:[{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"},{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}]},this.rows=[],this.property_id="",this._page=1,this._core.onComplete("user_loaded").then(()=>{console.log(this._userService.users),(this.form.components[3]?.fields?.[0].value).push(...this._userService.users)}),this._core.onComplete("user_loaded").then(()=>{console.log(this._userService.users),(this.form.components[4]?.fields?.[0].value).push(...this._userService.users)}),this._core.onComplete("user_loaded").then(()=>{console.log(this._userService.users),(this.form.components[5]?.fields?.[0].value).push(...this._userService.users)}),this.setRows(),this._route.paramMap.subscribe(o=>{this.property_id=o.get("property_id")||"",console.log(this.property_id)})}setRows(e=this._page){this._page=e,this._core.afterWhile(this,()=>{this._propertyrecordService.get({page:e,query:this._query()}).subscribe(i=>{this.rows.splice(0,this.rows.length),this.rows.push(...i)})},250)}_bulkManagement(e=!0){return()=>{this._form.modalDocs(e?[]:this.rows).then(i=>a(this,null,function*(){if(e)for(let t of i)this._preCreate(t),yield p(this._propertyrecordService.create(t));else{for(let t of this.rows)i.find(n=>n._id===t._id)||(yield p(this._propertyrecordService.delete(t)));for(let t of i){let n=this.rows.find(h=>h._id===t._id);n?(this._core.copy(t,n),yield p(this._propertyrecordService.update(n))):(this._preCreate(t),yield p(this._propertyrecordService.create(t)))}}this.setRows()}))}}_preCreate(e){e.__created=!1,this.property_id&&(e.property=this.property_id)}_query(){let e="";return this.property_id&&(e+=(e?"&":"")+"property="+this.property_id),e}};r.\u0275fac=function(i){return new(i||r)(s(b),s(q),s(S),s(I),s(v),s(j),s(C),s(w))},r.\u0275cmp=u({type:r,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Records",3,"columns","config","rows"]],template:function(i,t){i&1&&y(0,"wtable",0),i&2&&f("columns",t.columns)("config",t.config)("rows",t.rows)},dependencies:[R],encapsulation:2});let c=r;return c})();var A=[{path:"",component:d},{path:":property_id",component:d}],O=(()=>{let r=class r{};r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=_({type:r}),r.\u0275inj=m({imports:[g.forChild(A),k]});let c=r;return c})();export{O as PropertiesrecordsModule};
