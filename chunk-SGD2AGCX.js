import{a as X}from"./chunk-WVPEG5GS.js";import{a as ee}from"./chunk-62BC5FQB.js";import{a as E,b as Y}from"./chunk-IRHZLNJA.js";import{a as Z}from"./chunk-TRJDFIRG.js";import{g as G,h as K,k as Q}from"./chunk-4JG5HFOE.js";import"./chunk-VV24HN3E.js";import{$ as T,A as p,Ab as q,Gb as L,Ja as S,K as s,Ka as j,Nb as R,O as v,P as I,Q as F,U as w,Ua as N,Xa as M,Xb as H,Y as u,Ya as O,_ as C,_b as z,aa as J,ba as b,bb as k,ca as l,da as a,ea as P,ia as f,ja as m,ka as c,lb as B,mb as A,pb as U,ua as d,v as V,va as y,wa as h,wb as W,xa as D,ya as $,z as _}from"./chunk-7J63SMGH.js";var te=(t,r)=>r._id;function ce(t,r){if(t&1){let e=f();l(0,"div",18)(1,"winput",19),m("wChange",function(o){_(e);let n=c(2);return n.job.deadline=o+"",p(n.update())})("wChange",function(){_(e);let o=c(2);return p(o.update())}),a()()}if(t&2){let e=c(2);s(),b("value",e.job.deadline)}}function de(t,r){if(t&1){let e=f();l(0,"div",13),d(1," Job.Job details "),a(),l(2,"div",12)(3,"div",14)(4,"winput",15),m("wChange",function(o){_(e);let n=c();return n.job.name=o+"",p(n.update())}),a()(),l(5,"div",14)(6,"winput",16),m("wChange",function(o){_(e);let n=c();return n.job.description=o+"",p(n.update())})("wChange",function(){_(e);let o=c();return p(o.update())}),a()(),w(7,ce,2,1,"div",17),a()}if(t&2){let e=c();s(4),b("value",e.job.name),s(2),b("value",e.job.description),s(),b("ngIf",e.job.deadline)}}function _e(t,r){if(t&1&&(l(0,"div",14),d(1),a()),t&2){let e=c(2);s(),h(" ",e.job.description," ")}}function pe(t,r){if(t&1&&(l(0,"div",18)(1,"span",21),d(2,"Common.Deadline"),a(),l(3,"span"),d(4),S(5,"date"),a()()),t&2){let e=c(2);s(4),h(": ",j(5,1,e.job.deadline))}}function me(t,r){if(t&1&&(l(0,"div",12),w(1,_e,2,1,"div",20)(2,pe,6,3,"div",17),a()),t&2){let e=c();s(),b("ngIf",e.job.description),s(),b("ngIf",e.job.deadline)}}function ue(t,r){if(t&1&&(l(0,"div",18)(1,"span",21),d(2,"Common.Start date"),a(),l(3,"span"),d(4),S(5,"date"),a()()),t&2){let e=c().$implicit;s(4),h(": ",j(5,1,e.start))}}function Ce(t,r){if(t&1&&(l(0,"div",18)(1,"span",21),d(2,"Common.Deadline"),a(),l(3,"span"),d(4),S(5,"date"),a()()),t&2){let e=c().$implicit;s(4),h(": ",j(5,1,e.deadline))}}function ve(t,r){if(t&1&&(l(0,"div",12)(1,"div",22),d(2),a(),l(3,"div",18),d(4),a(),w(5,ue,6,3,"div",17)(6,Ce,6,3,"div",17),a()),t&2){let e=r.$implicit;s(2),y(e.name),s(2),h(" ",e.description," "),s(),b("ngIf",e.start),s(),b("ngIf",e.deadline)}}function be(t,r){if(t&1&&(l(0,"div",22),d(1,"Other jobs"),a(),w(2,ve,7,4,"div",23)),t&2){let e=c();s(2),b("ngForOf",e.jobs)}}function fe(t,r){if(t&1){let e=f();l(0,"div",22),d(1,"My proposal"),a(),l(2,"div",12),d(3),l(4,"wbutton",24),m("click",function(){_(e);let o=c();return p(o.mutateProposal())}),d(5,"Update"),a()()}if(t&2){let e=c();s(3),h(" ",e.proposal.price," ")}}function he(t,r){if(t&1&&(d(0),S(1,"date")),t&2){let e=c().$implicit;h(" start: ",j(1,1,e.start)," ")}}function xe(t,r){if(t&1&&(d(0),S(1,"date")),t&2){let e=c().$implicit;h(" Deadline: ",j(1,1,e.deadline)," ")}}function we(t,r){if(t&1&&(l(0,"div",29)(1,"div",30),d(2),a()()),t&2){let e=r.$implicit;s(2),$(" ",e.name," - ",e.use,"",e.type,"/",e.price,"$ ")}}function Se(t,r){if(t&1){let e=f();l(0,"wbutton",31),m("click",function(){_(e);let o=c().$implicit,n=c(2);return p(n.moreDetails(o))}),d(1,"Ask detailed proposal"),a()}}function je(t,r){if(t&1){let e=f();l(0,"wbutton",24),m("click",function(){_(e);let o=c().$implicit,n=c(2);return p(n.assignWorker(o))}),d(1,"Assign worker"),a()}}function ke(t,r){if(t&1&&(l(0,"div",12)(1,"div",22),d(2),a(),l(3,"div",18),d(4),u(5,he,2,3),u(6,xe,2,3),a(),l(7,"div",25),w(8,we,3,4,"div",26),a(),l(9,"div",27),u(10,Se,2,0,"wbutton",28),u(11,je,2,0,"wbutton"),a()()),t&2){let e=r.$implicit,i=c(2);s(2),h(" ",i.userService.doc(e.author).name," "),s(2),D(" Price: ",e.price,"$ Workdays: ",e.workdays," "),s(),C(e.start?5:-1),s(),C(e.deadline?6:-1),s(2),b("ngForOf",e.units),s(2),C(e.moreDetails?-1:10),s(),C(!i.job.worker||i.job.status==="New"?11:-1)}}function ge(t,r){if(t&1&&T(0,ke,12,8,"div",12,te),t&2){let e=c();J(e.proposals)}}function ye(t,r){if(t&1){let e=f();l(0,"div",22),d(1),a(),l(2,"wbutton",31),m("click",function(){let o=_(e).$implicit,n=c(2);return p(n.mutateTask(o))}),d(3,"Mutate task"),a(),l(4,"wbutton",31),m("click",function(){let o=_(e),n=o.$implicit,x=o.$index,g=c(2);return g.deleteTask(n),p(g.tasks.splice(x,1))}),d(5,"Delete task"),a()}if(t&2){let e=r.$implicit;s(),y(e.name)}}function Te(t,r){if(t&1){let e=f();l(0,"wbutton",31),m("click",function(){_(e);let o=c();return p(o.mutateTask())}),d(1,"Create task"),a(),T(2,ye,6,1,null,null,te)}if(t&2){let e=c();s(2),J(e.tasks)}}function Je(t,r){if(t&1){let e=f();l(0,"wbutton",24),m("click",function(){_(e);let o=c();return p(o.changeStatus("Invoiced"))}),d(1,"Invoiced"),a()}}function Ee(t,r){if(t&1){let e=f();l(0,"wbutton",24),m("click",function(){_(e);let o=c();return p(o.changeStatus("Paid"))}),d(1,"Paid"),a()}}function Ve(t,r){if(t&1){let e=f();l(0,"wbutton",24),m("click",function(){_(e);let o=c();return p(o.changeStatus("Completed"))}),d(1,"Completed"),a()}}var ie=(()=>{let r=class r{constructor(i,o,n,x,g,ne,oe,re,ae,se){this._proposalService=i,this.location=o,this._jobService=n,this.userService=x,this._http=g,this._form=ne,this._core=oe,this._router=re,this._datePipe=ae,this._taskService=se,this.job_id=this._router.url.replace("/job/",""),this.job=this._jobService.new(),this.jobs=[],this.proposal={job:this.job_id},this.proposals=[],this.tasks=[],this.formProposal=this._form.prepareForm(E),this.formTask=this._form.prepareForm(X),this._loadProposal(),this._loadJob()}goBack(){this.location.back()}update(){this._core.afterWhile(()=>{this._jobService.update(this.job)})}mutateProposal(){this._form.modal(this.formProposal,{label:this.proposal._id?"Update":"Create",click:(i,o)=>{o(),this._core.copy(i,this.proposal),this.proposal._id?this._proposalService.update(i):this._proposalService.create(i).subscribe(n=>{this._prepareDates(n),this._core.copy(n,this.proposal)})}},JSON.parse(JSON.stringify(this.proposal)))}moreDetails(i){i.moreDetails=!0,this._http.post("/api/property/details",i)}assignWorker(i){this.job.worker=i.author,this.job.start=i.start,this.job.deadline=i.deadline,this._http.post("/api/property/assign",i)}changeStatus(i){this.job.status=i,this._http.post("/api/property/status",this.job)}mutateTask(i={job:this.job_id}){this._form.modal(this.formTask,{label:i._id?"Update":"Create",click:(o,n)=>{n(),this._core.copy(o,i),i._id?this._taskService.update(o):this._taskService.create(o).subscribe(x=>{this.tasks.push(x)})}},JSON.parse(JSON.stringify(i)))}deleteTask(i){this._taskService.delete(i)}_loadProposal(){this._proposalService.fetch({job:this.job_id}).subscribe(i=>{i&&(this._prepareDates(i),this.proposal=i);let o=E.components.filter(n=>n.key==="start"||n.key==="deadline")||[];for(let n of o)n.hidden=!this.proposal.moreDetails})}_loadProposals(){this._proposalService.get({query:"job="+this.job_id},{name:"public"}).subscribe(i=>this.proposals=i)}_loadJob(){this._jobService.fetch({_id:this.job_id},{name:"public"}).subscribe(i=>{i&&(this.job=i,i.author===this.userService.user._id&&this._loadProposals(),i.property&&this._loadJobs(i.property),i.status!=="New"&&i.worker===this.userService.user._id&&this._loadTasks())})}_loadJobs(i){this._jobService.get({query:"property="+i+"&status=New,Assigned"}).subscribe(o=>this.jobs=o)}_loadTasks(){this._taskService.get({query:"job="+this.job_id}).subscribe(i=>this.tasks=i)}_prepareDates(i){i.start=this._datePipe.transform(i.start,"yyyy-MM-dd"),i.deadline=this._datePipe.transform(i.deadline,"yyyy-MM-dd")}};r.\u0275fac=function(o){return new(o||r)(v(Y),v(N),v(Z),v(G),v(L),v(H),v(q),v(B),v(k),v(ee))},r.\u0275cmp=I({type:r,selectors:[["ng-component"]],standalone:!1,decls:23,vars:9,consts:[[1,"propperty-p"],[1,"documents-wrapper"],[1,"documents-container"],[1,"documents-list"],[1,"documents-header"],[1,"documents-header-left"],[1,"documents-header-left__arrow"],[1,"material-icons",3,"click"],["routerLink","/profile"],[1,"documents-header__title"],[1,"documents-main"],[1,"documents-main-content"],[1,"documents-main-row"],["translate","",1,"documents__title"],[1,"job__input-title"],["placeholder","Enter title...",3,"wChange","value"],["placeholder","Enter description...","type","textarea",3,"wChange","value"],["class","documents__description",4,"ngIf"],[1,"documents__description"],["placeholder","Enter deadline...","type","date",3,"wChange","value"],["class","job__input-title",4,"ngIf"],["translate",""],[1,"documents__title"],["class","documents-main-row",4,"ngFor","ngForOf"],[3,"click"],[1,"documents-tags"],["class","documents-tags__wrap",4,"ngFor","ngForOf"],[1,"job-btns"],[1,"mb-10"],[1,"documents-tags__wrap"],[1,"documents-tags__item"],[1,"mb-10",3,"click"]],template:function(o,n){o&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"span",7),m("click",function(){return n.goBack()}),d(8,"arrow_back_ios"),a()(),P(9,"core-profile",8),a(),l(10,"div",9),d(11),a()(),l(12,"div",10)(13,"div",11),u(14,de,8,3)(15,me,3,2,"div",12),u(16,be,3,1),u(17,fe,6,1),u(18,ge,2,0),u(19,Te,4,0),u(20,Je,2,0,"wbutton"),u(21,Ee,2,0,"wbutton"),u(22,Ve,2,0,"wbutton"),a()()()()()()),o&2&&(s(11),y(n.job.name||"Job"),s(3),C(n.job.author===n.userService.user._id?14:n.job.description||n.job.deadline?15:-1),s(2),C(n.jobs.length?16:-1),s(),C(n.userService.role("propertyworker")&&n.job.author!==n.userService.user._id?17:-1),s(),C(n.userService.user._id===n.job.author&&n.job.status==="New"?18:-1),s(),C(n.job.worker===n.userService.user._id&&n.job.status==="Assigned"?19:-1),s(),C(n.job.worker===n.userService.user._id&&n.job.status==="Assigned"?20:-1),s(),C(n.job.author===n.userService.user._id&&n.job.status==="Invoiced"?21:-1),s(),C(n.job.worker===n.userService.user._id&&n.job.status==="Completed"?22:-1))},dependencies:[A,z,M,O,W,R,K,k],encapsulation:2});let t=r;return t})();var Ie=[{path:":_id",component:ie}],Xe=(()=>{let r=class r{};r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=F({type:r}),r.\u0275inj=V({providers:[k],imports:[U.forChild(Ie),Q]});let t=r;return t})();export{Xe as JobModule};
